(()=>{"use strict";var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function s(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,i(a.key),a)}}function i(e){var s=function(e){if("object"!=t(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(s)?s:s+""}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(a=function(){return!!e})()}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}e.p="/";var n=function(){function e(){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(s=function(e,s,i){return s=o(s),function(e,s){if(s&&("object"==t(s)||"function"==typeof s))return s;if(void 0!==s)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,a()?Reflect.construct(s,i||[],o(e).constructor):s.apply(e,i))}(this,e,[{key:"TitleScene"}])).isTransitioning=!1,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}(e,Phaser.Scene),i=e,(n=[{key:"preload",value:function(){var e=this;this.loadingText=this.add.text(400,300,"Loading...",{fontSize:"32px",fill:"#fff",fontFamily:"Arial"}).setOrigin(.5),this.load.on("progress",(function(t){e.loadingText.setText("Loading... ".concat(Math.round(100*t),"%"))}));try{this.load.image("title","assets/title.png"),this.load.audio("intro","assets/intro.mp3")}catch(e){console.error("Error in preload:",e),this.loadingText.setText("Error loading assets. Retrying..."),this.scene.restart()}this.load.on("complete",(function(){e.loadingText&&e.loadingText.destroy()}))}},{key:"create",value:function(){var e=this;try{this.textures.exists("title")?this.add.image(400,300,"title").setDisplaySize(800,600):this.add.text(400,200,"The Old Get Together",{fontSize:"48px",fill:"#fff",fontFamily:"Arial",align:"center"}).setOrigin(.5);try{this.introMusic=this.sound.add("intro",{loop:!0,volume:.7}),this.sound.locked?this.sound.once("unlocked",(function(){e.playIntroMusic()})):this.playIntroMusic()}catch(e){console.error("Error setting up audio:",e)}this.startText=this.add.text(400,500,"Press SPACE to Start",{fontSize:"24px",fill:"#fff",fontFamily:"Arial"}).setOrigin(.5),this.tweens.add({targets:this.startText,alpha:0,duration:800,ease:"Power2",yoyo:!0,repeat:-1}),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.canStart=!0}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading title screen\nPress SPACE to retry",{fontSize:"24px",fill:"#fff",fontFamily:"Arial",align:"center"}).setOrigin(.5),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.canStart=!0}}},{key:"update",value:function(){this.canStart&&this.spaceKey&&this.spaceKey.isDown&&(this.canStart=!1,this.handleSceneTransition())}},{key:"playIntroMusic",value:function(){try{this.introMusic&&!this.introMusic.isPlaying&&this.introMusic.play()}catch(e){console.error("Error playing intro music:",e)}}},{key:"handleSceneTransition",value:function(){var e=this;if(!this.isTransitioning){this.isTransitioning=!0;try{this.introMusic&&this.introMusic.isPlaying?this.tweens.add({targets:this.introMusic,volume:0,duration:1e3,onComplete:function(){e.introMusic.stop(),e.startGameScene()}}):this.startGameScene()}catch(e){console.error("Error during scene transition:",e),this.startGameScene()}}}},{key:"startGameScene",value:function(){try{this.scene.start("GameScene",{startMusic:!0})}catch(e){console.error("Error starting game scene:",e),this.isTransitioning=!1}}},{key:"shutdown",value:function(){try{this.isTransitioning=!1,this.canStart=!1,this.introMusic&&this.introMusic.isPlaying&&this.introMusic.stop(),this.input.keyboard.shutdown(),this.tweens.killAll()}catch(e){console.error("Error during shutdown:",e)}}}])&&s(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,n}();const l=e.p+"assets/herowalking.png",h=e.p+"assets/possum.png",c=e.p+"assets/heart.png",u=e.p+"assets/background2.png",d=e.p+"assets/dead.png",p=e.p+"assets/soundtrack.mp3",y=e.p+"assets/boss.mp3",f=e.p+"assets/intro.mp3",b=e.p+"assets/sign.png",m=e.p+"assets/spencers.png",g=e.p+"assets/popworks.png",v=e.p+"assets/wrap.png",w=e.p+"assets/taco.png",S=e.p+"assets/baseball.png",k=e.p+"assets/booths.png",P=e.p+"assets/booth2.png",T=e.p+"assets/fox.png",B=e.p+"assets/foxhurt.png",x=e.p+"assets/barn.png",O=e.p+"assets/herohurt.png",M=e.p+"assets/ticket.png",C=e.p+"assets/final.png";function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function j(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,R(i.key),i)}}function R(e){var t=function(e){if("object"!=D(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=D(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==D(t)?t:t+""}function E(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(E=function(){return!!e})()}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},H(e)}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}var _=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,s){return t=H(t),function(e,t){if(t&&("object"==D(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,E()?Reflect.construct(t,s||[],H(e).constructor):t.apply(e,s))}(this,e,[{key:"GameScene"}])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}(e,Phaser.Scene),t=e,(s=[{key:"init",value:function(e){this.health=e.health||3,this.isInvulnerable=!1,this.shouldStartMusic=e&&e.startMusic,this.score=e.score||0,this.bossDefeated=!1,this.bossHealth=5,this.bossRevealed=!1,this.isRevealSequence=!1,this.level=e.level||1,2===this.level?(this.bossHealth=7,this.possumSpawnDelay=3e3):this.possumSpawnDelay=5e3}},{key:"preload",value:function(){var e=this;this.loadingText=this.add.text(400,300,"Loading...",{fontSize:"32px",fill:"#fff",fontFamily:"Arial"}).setOrigin(.5),this.loadingText.setScrollFactor(0),this.load.on("progress",(function(t){e.loadingText.setText("Loading... ".concat(Math.round(100*t),"%"))}));try{this.load.spritesheet("player",l,{frameWidth:44,frameHeight:48}),this.load.spritesheet("possum",h,{frameWidth:55,frameHeight:50}),this.load.image("heart",c),this.load.image("background",u),this.load.image("burst",d),this.load.image("sign",b),this.load.image("spencers",m),this.load.image("taco",w),this.load.image("baseball",S),this.load.image("booths",k),this.load.image("booth2",P),this.load.image("fox",T),this.load.image("foxhurt",B),this.load.image("barn",x),this.load.image("herohurt",O),this.load.image("ticket",M),this.load.image("final",C),this.load.image("popworks",g),this.load.image("wrap",v),this.load.audio("gameMusic",p),this.load.audio("bossMusic",y),this.load.audio("introMusic",f)}catch(e){console.error("Error loading assets:",e),this.loadingText.setText("Error loading assets. Retrying..."),this.scene.restart()}this.load.on("complete",(function(){e.loadingText&&e.loadingText.destroy()}))}},{key:"create",value:function(){var e=this;try{if(this.physics.world.setBounds(0,0,4800,600),this.cameras.main.setBounds(0,0,4800,600),this.cursors=this.input.keyboard.createCursorKeys(),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.physics.world.gravity.y=800,this.bg=this.add.tileSprite(0,0,4800,600,"background"),this.bg.setOrigin(0,0),this.bg.setScrollFactor(1),this.bg.width=4800,this.ground=this.add.rectangle(2400,550,4800,32,0,0),this.physics.add.existing(this.ground,!0),2===this.level){this.player=this.physics.add.sprite(100,450,"player"),this.final=this.add.image(4400,340,"final");var t=300/this.textures.get("final").getSourceImage().height;this.final.setScale(t),this.final.setScrollFactor(1),this.bg.setTint(13421823)}else{this.sign=this.add.image(200,480,"sign"),this.sign.setScale(.8),this.sign.setScrollFactor(1),this.popworks=this.add.image(800,400,"popworks"),this.popworks.setScale(.72),this.popworks.setScrollFactor(1),this.spencers=this.add.image(1300,440,"spencers"),this.spencers.setScale(.72),this.spencers.setScrollFactor(1),this.wrap=this.add.image(1800,400,"wrap"),this.wrap.setScale(.72),this.wrap.setScrollFactor(1),this.taco=this.add.image(2300,440,"taco"),this.taco.setScale(.72),this.taco.setScrollFactor(1),this.baseball=this.add.image(2800,440,"baseball");var s=240/this.textures.get("baseball").getSourceImage().height;this.baseball.setScale(s),this.baseball.setScrollFactor(1),this.booths=this.add.image(3300,440,"booths");var i=240/this.textures.get("booths").getSourceImage().height;this.booths.setScale(i),this.booths.setScrollFactor(1),this.booth2=this.add.image(3800,440,"booth2");var a=240/this.textures.get("booth2").getSourceImage().height;this.booth2.setScale(a),this.booth2.setScrollFactor(1),this.barn=this.add.image(4400,340,"barn");var o=300/this.textures.get("barn").getSourceImage().height;this.barn.setScale(o),this.barn.setScrollFactor(1),this.barn.setAlpha(1),this.player=this.physics.add.sprite(100,450,"player")}if(this.player.setScale(100/48),this.player.setBounce(.2),this.player.setCollideWorldBounds(!0),this.anims.create({key:"walk",frames:this.anims.generateFrameNumbers("player",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:"idle",frames:[{key:"player",frame:0}],frameRate:10}),this.anims.create({key:"possum-walk",frames:this.anims.generateFrameNumbers("possum",{start:0,end:1}),frameRate:6,repeat:-1}),1===this.level){this.boss=this.physics.add.sprite(4500,450,"fox");var r=200/this.textures.get("fox").getSourceImage().height;this.boss.setScale(r),this.boss.setBounce(.2),this.boss.setCollideWorldBounds(!0),this.boss.setAlpha(0),this.bossHealthBar=this.add.graphics(),this.bossHealthBar.setScrollFactor(1),this.bossHealthBar.setAlpha(0),this.updateBossHealthBar(),this.bossMusicTrack=this.sound.add("bossMusic",{loop:!0,volume:0}),this.bossTween=this.tweens.add({targets:this.boss,x:this.boss.x-400,duration:3e3,yoyo:!0,repeat:-1,paused:!0,onYoyo:function(){e.boss.setFlipX(!0)},onRepeat:function(){e.boss.setFlipX(!1),Math.random()<.5&&!e.boss.isDead&&e.boss.setVelocityY(-250)}})}this.gameMusic=this.sound.add("gameMusic",{loop:!0,volume:0}),this.shouldStartMusic&&(this.gameMusic.play(),this.tweens.add({targets:this.gameMusic,volume:.5,duration:1e3})),this.possums=this.physics.add.group(),this.spawnPossum(),this.heartPickups=this.physics.add.group(),this.possumSpawnTimer=this.time.addEvent({delay:this.possumSpawnDelay,callback:this.spawnPossum,callbackScope:this,loop:!0}),this.cameras.main.setBounds(0,0,4800,600),this.cameras.main.startFollow(this.player,!0,.08,.08),this.cameras.main.setZoom(1),this.hearts=this.add.group(),this.updateHealthDisplay(),this.physics.add.collider(this.player,this.ground),this.physics.add.collider(this.possums,this.ground),this.physics.add.collider(this.heartPickups,this.ground),this.physics.add.collider(this.boss,this.ground),this.physics.add.overlap(this.player,this.possums,this.handlePossumCollision,null,this),this.physics.add.overlap(this.player,this.heartPickups,this.handleHeartPickup,null,this),this.physics.add.overlap(this.player,this.boss,this.handleBossCollision,null,this),this.scoreText=this.add.text(700,16,"Score: 0",{fontSize:"32px",fill:"#fff",stroke:"#000",strokeThickness:4,align:"right"}),this.scoreText.setScrollFactor(0),this.scoreText.setOrigin(1,0)}catch(e){console.error("Error creating scene:",e)}}},{key:"spawnPossum",value:function(){try{var e=this.possums.create(this.cameras.main.scrollX+900,450,"possum");e.setVelocityX(-150),e.play("possum-walk"),e.setScale(1.5),e.setBounce(.2),e.setCollideWorldBounds(!0),e.checkWorldBounds=!0,e.outOfBoundsKill=!0,this.time.addEvent({delay:2e3,callback:function(){e.active&&!e.isDead&&e.setVelocityY(-300)},loop:!0})}catch(e){console.error("Error spawning possum:",e)}}},{key:"handlePossumCollision",value:function(e,t){e.body.velocity.y>0&&e.y<t.y&&!t.isDead?(this.killPossum(t),e.setVelocityY(-300)):this.isInvulnerable||t.isDead||(this.takeDamage(),this.makePlayerInvulnerable())}},{key:"updateHealthDisplay",value:function(){this.hearts.clear(!0,!0);for(var e=0;e<this.health;e++){var t=this.add.image(50+40*e,50,"heart");t.setScrollFactor(0),t.setScale(.5),this.hearts.add(t)}}},{key:"handleHeartPickup",value:function(e,t){if(this.health<5){this.health++,this.updateHealthDisplay();var s=this.add.image(t.x,t.y,"burst");s.setScale(.3),s.setTint(16776960),this.tweens.add({targets:s,scale:1,alpha:0,duration:300,ease:"Power2",onComplete:function(){s.destroy()}})}t.destroy()}},{key:"killPossum",value:function(e){var t=this;e.isDead=!0;var s=this.add.image(e.x,e.y,"burst");if(s.setScale(.5),this.score+=10,this.scoreText.setText("Score: "+this.score),Math.random()<.75){var i=this.heartPickups.create(e.x,e.y,"heart");i.setBounce(.4),i.setCollideWorldBounds(!0),i.setVelocity(Phaser.Math.Between(-100,100),-200),i.setScale(.4),this.tweens.add({targets:i,y:i.y-10,duration:1e3,ease:"Sine.inOut",yoyo:!0,repeat:-1}),this.time.delayedCall(1e4,(function(){i.active&&t.tweens.add({targets:i,alpha:0,duration:500,ease:"Power2",onComplete:function(){i.destroy()}})}))}this.tweens.add({targets:s,scale:2,alpha:0,duration:500,ease:"Power2",onComplete:function(){s.destroy()}}),e.setVelocity(0,0),this.tweens.add({targets:e,alpha:0,duration:200,ease:"Power2",onComplete:function(){e.destroy()}})}},{key:"makePlayerInvulnerable",value:function(){var e=this;this.isInvulnerable=!0,this.player.scale,this.player.setTexture("herohurt"),this.player.setTint(16711680),this.playerPulseTween=this.tweens.add({targets:this.player,alpha:.5,duration:100,yoyo:!0,repeat:2,ease:"Linear",onComplete:function(){e.player.setAlpha(1),e.player.clearTint()}}),this.time.delayedCall(1e3,(function(){e.isInvulnerable=!1,e.player.setTexture("player")}),[],this)}},{key:"update",value:function(){var e=this;try{if(!this.cursors||!this.player)return void console.error("Required game objects not initialized");var t=this.player.body.touching.down;if(!this.bossRevealed&&this.player.x>3800&&this.startBossReveal(),this.isRevealSequence?(this.player.setVelocityX(0),this.player.play("idle",!0)):(this.cursors.left.isDown?(this.player.setVelocityX(-300),this.player.setFlipX(!0),t&&this.player.play("walk",!0)):this.cursors.right.isDown?(this.player.setVelocityX(300),this.player.setFlipX(!1),t&&this.player.play("walk",!0)):(this.player.setVelocityX(0),t&&this.player.play("idle",!0)),this.spaceKey&&this.spaceKey.isDown&&t&&this.player.setVelocityY(-400)),this.boss&&!this.boss.isDead&&(this.updateBossHealthBar(),!this.isRevealSequence&&Math.abs(this.player.x-this.boss.x)<300&&Math.random()<.01&&this.boss.setVelocityY(-200),!this.isRevealSequence&&this.physics.overlap(this.player,this.boss))){var s=this.player.y+this.player.height/2,i=this.boss.y-this.boss.height/3;this.player.body.velocity.y>0&&s<this.boss.y&&!this.boss.isHurt?(this.hitBoss(),this.player.setVelocityY(-500)):!this.isInvulnerable&&s>i&&!this.boss.isHurt&&(this.takeDamage(),this.makePlayerInvulnerable())}this.player.y>this.game.config.height&&(this.takeDamage(),this.player.setPosition(this.cameras.main.scrollX+100,450)),this.possums&&this.possums.children.iterate((function(t){t&&!t.isDead&&(t.x<e.cameras.main.scrollX-100?t.destroy():t.body.touching.down&&t.setVelocityX(-150))})),this.heartPickups&&this.heartPickups.children.iterate((function(t){t&&t.x<e.cameras.main.scrollX-200&&t.destroy()}))}catch(e){console.error("Error in update:",e)}}},{key:"takeDamage",value:function(){if(this.health>0){this.health--;var e=this.hearts.getChildren()[this.health];e&&e.setVisible(!1),0===this.health&&(this.gameMusic&&this.gameMusic.isPlaying&&this.gameMusic.stop(),this.bossMusicTrack&&this.bossMusicTrack.isPlaying&&this.bossMusicTrack.stop(),this.scene.start("GameOverScene",{score:this.score}))}}},{key:"hitBoss",value:function(){var e=this;this.boss.isDead||this.boss.isHurt||(this.bossHealth--,this.updateBossHealthBar(),this.boss.isHurt=!0,this.boss.setTexture("foxhurt"),this.boss.setTint(16711680),this.tweens.add({targets:this.boss,alpha:.5,duration:100,yoyo:!0,repeat:4,ease:"Linear",onComplete:function(){e.boss.isDead||(e.boss.setAlpha(1),e.boss.clearTint(),e.boss.setTexture("fox"),e.boss.isHurt=!1)}}),this.bossHealth<=0&&this.defeatBoss())}},{key:"updateBossHealthBar",value:function(){if(this.boss&&!this.boss.isDead){this.bossHealthBar.clear(),this.bossHealthBar.fillStyle(0,.7),this.bossHealthBar.fillRect(this.boss.x-50,this.boss.y-80,100,10);var e=this.bossHealth/5;this.bossHealthBar.fillStyle(16711680,1),this.bossHealthBar.fillRect(this.boss.x-50,this.boss.y-80,100*e,10)}}},{key:"startBossReveal",value:function(){var e=this;this.bossRevealed||(this.bossRevealed=!0,this.isRevealSequence=!0,this.cameras.main.stopFollow(),this.cameras.main.pan(4200,300,2e3,"Power2",!0,(function(t,s){1===s&&(e.physics.world.setBounds(3800,0,800,600),e.player.setCollideWorldBounds(!0),e.boss.setCollideWorldBounds(!0),e.possumSpawnTimer&&e.possumSpawnTimer.destroy(),e.possums.getChildren().forEach((function(t){e.tweens.add({targets:t,alpha:0,duration:500,ease:"Power2",onComplete:function(){t.destroy()}})})),e.tweens.add({targets:e.gameMusic,volume:0,duration:2e3,ease:"Power2"}),e.bossMusicTrack.play(),e.tweens.add({targets:e.bossMusicTrack,volume:.5,duration:2e3,ease:"Power2"}),e.tweens.add({targets:[e.boss,e.bossHealthBar],alpha:1,duration:1500,ease:"Power2",onComplete:function(){e.bossTween.resume(),e.isRevealSequence=!1}}))})))}},{key:"defeatBoss",value:function(){var e=this;if(!this.boss.isDead){this.boss.isDead=!0,this.bossDefeated=!0,this.bossTween&&this.bossTween.stop(),this.boss.setVelocity(0,0),this.tweens.add({targets:this.bossMusicTrack,volume:0,duration:2e3,ease:"Power2",onComplete:function(){e.bossMusicTrack.stop()}}),this.score+=1e3,this.scoreText.setText("Score: "+this.score);var t=function(t){var s=e.add.image(e.boss.x+Phaser.Math.Between(-30,30),e.boss.y+Phaser.Math.Between(-30,30),"burst");s.setScale(.5),s.setAlpha(.7),e.tweens.add({targets:s,scale:2,alpha:0,duration:800,delay:t,ease:"Power2",onComplete:function(){return s.destroy()}})},s=[16776960,65280,255,16711935,16711680],i=0,a=0,o=this.time.addEvent({delay:100,callback:function(){if(e.boss&&!e.boss.destroyed&&(e.boss.setTint(s[i]),i=(i+1)%s.length,++a%2==0&&t(0),a>=10)){o.destroy();for(var r=0;r<5;r++)t(200*r);var n=e.physics.add.sprite(e.boss.x,e.boss.y,"ticket");n.setScale(.5),n.setBounce(.4),n.setCollideWorldBounds(!0),n.setVelocityY(-200),e.physics.add.collider(n,e.ground,(function(){n.setVelocity(0,0),n.setGravity(0),e.tweens.add({targets:n,y:n.y-15,duration:1500,ease:"Sine.inOut",yoyo:!0,repeat:-1})}),null,e),e.physics.add.overlap(e.player,n,(function(){if(n.active){e.physics.pause(),e.player.anims.pause(),e.player.setVelocity(0,0),e.sound.add("introMusic",{volume:.5}).play();var t=e.add.rectangle(0,0,e.game.config.width,e.game.config.height,0);t.setOrigin(0,0),t.setScrollFactor(0),t.setDepth(1e3),t.alpha=0,e.tweens.add({targets:[t,n],alpha:1,duration:2e3,ease:"Power2",onComplete:function(){e.sound.stopAll(),e.scene.start("Level2Scene",{health:e.health,score:e.score})}})}}),null,e),e.tweens.add({targets:e.boss,scaleX:1.5,scaleY:0,alpha:0,duration:1e3,ease:"Power2",onComplete:function(){e.boss&&e.boss.destroy(),e.bossHealthBar&&e.bossHealthBar.destroy()}})}},loop:!0})}}},{key:"createConfetti",value:function(){for(var e=this,t=[16711680,65280,255,16776960,16711935,65535],s=[],i=0;i<50;i++)this.createConfettiParticle(t,s);this.time.addEvent({delay:100,callback:function(){for(var i=s.length-1;i>=0;i--)s[i].active||s.splice(i,1);for(;s.length<50;)e.createConfettiParticle(t,s)},loop:!0})}},{key:"createConfettiParticle",value:function(e,t){var s=Phaser.Math.Between(0,this.game.config.width),i=Phaser.Utils.Array.GetRandom(e),a=this.add.rectangle(s,-20,10,10,i);return a.setScrollFactor(0),a.setDepth(1002),a.setAlpha(.8),a.angle=Phaser.Math.Between(0,360),this.tweens.add({targets:a,y:this.game.config.height+20,angle:a.angle+Phaser.Math.Between(180,360),duration:Phaser.Math.Between(4e3,6e3),ease:"Linear",onComplete:function(){a.destroy()}}),this.tweens.add({targets:a,x:a.x+Phaser.Math.Between(-100,100),duration:Phaser.Math.Between(2e3,3e3),ease:"Sine.easeInOut",yoyo:!0,repeat:-1}),t.push(a),a}},{key:"shutdown",value:function(){try{this.time.removeAllEvents(),this.tweens.killAll(),this.gameMusic&&this.gameMusic.isPlaying&&this.gameMusic.stop(),this.bossMusicTrack&&this.bossMusicTrack.isPlaying&&this.bossMusicTrack.stop(),this.possums&&this.possums.destroy(!0),this.hearts&&this.hearts.destroy(!0),this.heartPickups&&this.heartPickups.destroy(!0),this.input.keyboard.shutdown(),this.physics.world.shutdown()}catch(e){console.error("Error during shutdown:",e)}}},{key:"handleBossCollision",value:function(e,t){if(this.bossRevealed&&!t.isDead&&!this.isRevealSequence){var s=e.y+e.height*e.scale/2,i=t.y-t.height*t.scale/2,a=t.height*t.scale*.4;if(e.body.velocity.y>0&&s<i+a&&!t.isHurt)this.hitBoss(),e.setVelocityY(-500);else if(!this.isInvulnerable&&!t.isHurt&&s>i+a){this.takeDamage(),this.makePlayerInvulnerable();var o=e.x<t.x?-1:1;e.setVelocityX(300*o),e.setVelocityY(-200)}}}}])&&j(t.prototype,s),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,s}();function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function V(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,K(i.key),i)}}function K(e){var t=function(e){if("object"!=A(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=A(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==A(t)?t:t+""}function I(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(I=function(){return!!e})()}function X(e){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},X(e)}function Y(e,t){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Y(e,t)}const W=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,s){return t=X(t),function(e,t){if(t&&("object"==A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,I()?Reflect.construct(t,s||[],X(e).constructor):t.apply(e,s))}(this,e,[{key:"EndScene"}])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Y(e,t)}(e,Phaser.Scene),t=e,(s=[{key:"init",value:function(e){this.score=e.score||0}},{key:"preload",value:function(){this.load.image("final","assets/final.png"),this.load.audio("victory-music","assets/end.mp3")}},{key:"create",value:function(){this.input.keyboard.removeAllKeys(!0);var e=this.add.image(400,300,"final"),t=this.cameras.main.width/e.width,s=this.cameras.main.height/e.height,i=Math.max(t,s);e.setScale(i);var a=this.sound.add("victory-music",{loop:!1,volume:.7});this.sound.locked||a.play(),this.add.text(400,450,"Final Score: ".concat(this.score),{fontSize:"48px",fill:"#fff",fontFamily:"Arial",stroke:"#000",strokeThickness:8,shadow:{offsetX:2,offsetY:2,color:"#000",blur:8,fill:!0}}).setOrigin(.5);var o=this.add.text(400,500,"Refresh page to play again",{fontSize:"32px",fill:"#fff",fontFamily:"Arial",stroke:"#000",strokeThickness:6,shadow:{offsetX:2,offsetY:2,color:"#000",blur:8,fill:!0}}).setOrigin(.5);this.tweens.add({targets:o,alpha:0,duration:800,ease:"Power2",yoyo:!0,repeat:-1}),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.canRestart=!0,this.victoryMusic=a}},{key:"update",value:function(){var e=this;this.canRestart&&this.spaceKey&&this.spaceKey.isDown&&(this.canRestart=!1,this.victoryMusic&&this.victoryMusic.isPlaying?this.tweens.add({targets:this.victoryMusic,volume:0,duration:1e3,onComplete:function(){e.victoryMusic.stop(),e.scene.start("TitleScene")}}):this.scene.start("TitleScene"))}},{key:"shutdown",value:function(){this.victoryMusic&&this.victoryMusic.isPlaying&&this.victoryMusic.stop(),this.tweens.killAll(),this.input.keyboard.removeAllKeys(!0)}}])&&V(t.prototype,s),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,s}();function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function G(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,z(i.key),i)}}function z(e){var t=function(e){if("object"!=q(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=q(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==q(t)?t:t+""}function L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(L=function(){return!!e})()}function N(e){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},N(e)}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}const Z=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,s){return t=N(t),function(e,t){if(t&&("object"==q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,L()?Reflect.construct(t,s||[],N(e).constructor):t.apply(e,s))}(this,e,[{key:"GameOverScene"}])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(e,Phaser.Scene),t=e,(s=[{key:"preload",value:function(){this.load.image("gameover-bg","assets/gameoverscreen.png")}},{key:"create",value:function(){this.add.image(400,300,"gameover-bg").setDisplaySize(800,600);var e=this.add.text(400,400,"Press SPACE to try again",{fontSize:"48px",fill:"#fff",fontFamily:"Arial",stroke:"#000",strokeThickness:6}).setOrigin(.5);this.tweens.add({targets:e,alpha:0,duration:800,ease:"Power2",yoyo:!0,repeat:-1}),this.input.keyboard.removeAllKeys(!0),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.canRestart=!0}},{key:"update",value:function(){this.canRestart&&this.spaceKey.isDown&&(this.canRestart=!1,this.tweens.killAll(),this.scene.start("GameScene",{startMusic:!0,health:3,score:0,level:1}))}},{key:"shutdown",value:function(){this.tweens.killAll(),this.input.keyboard.removeAllKeys(!0)}}])&&G(t.prototype,s),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,s}(),J=e.p+"assets/woodbackground.png";function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function $(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ee(i.key),i)}}function ee(e){var t=function(e){if("object"!=Q(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=Q(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Q(t)?t:t+""}function te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(te=function(){return!!e})()}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}function ie(e,t){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ie(e,t)}var ae=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,s){return t=se(t),function(e,t){if(t&&("object"==Q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,te()?Reflect.construct(t,s||[],se(e).constructor):t.apply(e,s))}(this,e,[{key:"BarnScene"}])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ie(e,t)}(e,Phaser.Scene),t=e,(s=[{key:"init",value:function(e){this.health=e.health||3,this.score=e.score||0}},{key:"preload",value:function(){this.load.image("woodbackground",J),this.load.spritesheet("player",l,{frameWidth:44,frameHeight:48})}},{key:"create",value:function(){this.add.image(400,300,"woodbackground").setScale(1.2),this.blackOverlay=this.add.rectangle(0,0,this.game.config.width,this.game.config.height,0),this.blackOverlay.setOrigin(0,0),this.blackOverlay.setDepth(1e3),this.blackOverlay.alpha=1,this.anims.exists("walk")||this.anims.create({key:"walk",frames:this.anims.generateFrameNumbers("player",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.exists("idle")||this.anims.create({key:"idle",frames:[{key:"player",frame:0}],frameRate:10}),this.player=this.add.sprite(100,450,"player");this.player.setScale(100/48),this.startTransitionSequence()}},{key:"startTransitionSequence",value:function(){var e=this;this.tweens.add({targets:this.blackOverlay,alpha:0,duration:1e3,ease:"Power2",onComplete:function(){e.player.play("walk",!0),e.tweens.add({targets:e.player,x:600,duration:2e3,ease:"Linear",onComplete:function(){e.player.play("idle",!0),e.time.delayedCall(1e3,(function(){e.tweens.add({targets:e.blackOverlay,alpha:1,duration:1e3,ease:"Power2",onComplete:function(){e.tweens.killAll(),e.scene.start("GameScene",{level:2,health:e.health,score:e.score,startMusic:!0})}})}))}})}})}},{key:"shutdown",value:function(){this.tweens.killAll(),this.player&&this.player.destroy()}}])&&$(t.prototype,s),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,s}();const oe=e.p+"assets/emptystage.png",re=e.p+"assets/racoon.png";function ne(e){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne(e)}function le(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,he(i.key),i)}}function he(e){var t=function(e){if("object"!=ne(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=ne(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ne(t)?t:t+""}function ce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ce=function(){return!!e})()}function ue(e){return ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ue(e)}function de(e,t){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},de(e,t)}var pe=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,s){return t=ue(t),function(e,t){if(t&&("object"==ne(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ce()?Reflect.construct(t,s||[],ue(e).constructor):t.apply(e,s))}(this,e,[{key:"Level2Scene"}])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&de(e,t)}(e,Phaser.Scene),t=e,(s=[{key:"init",value:function(e){this.health=e.health||3,this.score=e.score||0,this.stageRevealed=!1,this.bossDefeated=!1,this.bossHealth=7,this.bossRevealed=!1}},{key:"preload",value:function(){this.load.image("woodbackground",J),this.load.image("emptystage",oe),this.load.image("raccoon",re),this.load.image("burst",d),this.load.image("ticket",M),this.load.image("final","assets/final.png"),this.load.image("bat","assets/bat.png"),this.load.image("animalband1","assets/animalband1.png"),this.load.image("animalband2","assets/animalband2.png"),this.load.spritesheet("player",l,{frameWidth:44,frameHeight:48}),this.load.spritesheet("possum",h,{frameWidth:55,frameHeight:50}),this.load.image("heart",c),this.load.audio("gameMusic",p),this.load.audio("bossMusic",y)}},{key:"create",value:function(){var e=this,t=this.add.rectangle(0,0,this.game.config.width,this.game.config.height,0);t.setOrigin(0,0),t.setScrollFactor(0),t.setDepth(1e3),this.tweens.add({targets:t,alpha:0,duration:2e3,ease:"Power2"}),this.physics.world.setBounds(0,0,4800,600),this.cameras.main.setBounds(0,0,4800,600),this.physics.world.gravity.y=800,this.bg=this.add.tileSprite(0,0,4800,600,"woodbackground"),this.bg.setOrigin(0,0),this.bg.setScrollFactor(1),this.bg.width=4800,this.bg.setDepth(0),this.animalBand=this.add.sprite(4400,250,"animalband1");var s=200/this.textures.get("animalband1").getSourceImage().height;this.animalBand.setScale(s),this.animalBand.setDepth(3),this.animalBand.setVisible(!1),this.bandTween=this.tweens.add({targets:this.animalBand,alpha:{from:1,to:1},duration:500,repeat:-1,paused:!0,onRepeat:function(){e.animalBand.setTexture("animalband1"===e.animalBand.texture.key?"animalband2":"animalband1")}}),this.ground=this.add.rectangle(2400,550,4800,32,0,0),this.physics.add.existing(this.ground,!0),this.ground.setDepth(1),this.player=this.physics.add.sprite(100,450,"player");this.player.setScale(100/48),this.player.setBounce(.2),this.player.setCollideWorldBounds(!0),this.player.setDepth(3),this.anims.create({key:"walk",frames:this.anims.generateFrameNumbers("player",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:"idle",frames:[{key:"player",frame:0}],frameRate:10}),this.cursors=this.input.keyboard.createCursorKeys(),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.anims.create({key:"possum-walk",frames:this.anims.generateFrameNumbers("possum",{start:0,end:1}),frameRate:6,repeat:-1}),this.possums=this.physics.add.group(),this.spawnPossum(),this.possumSpawnTimer=this.time.addEvent({delay:5e3,callback:this.spawnPossum,callbackScope:this,loop:!0}),this.emptyStage=this.add.image(4400,300,"emptystage"),this.emptyStage.setOrigin(.5,.5),this.emptyStage.setScrollFactor(1);var i=600/this.textures.get("emptystage").getSourceImage().height;this.emptyStage.setScale(i),this.emptyStage.setDepth(2),this.boss=this.physics.add.sprite(4500,450,"raccoon");var a=200/this.textures.get("raccoon").getSourceImage().height;this.boss.setScale(a),this.boss.setBounce(.2),this.boss.setCollideWorldBounds(!0),this.boss.setAlpha(0),this.boss.setDepth(3),this.bossHealthBar=this.add.graphics(),this.bossHealthBar.setScrollFactor(1),this.bossHealthBar.setAlpha(0),this.bossHealthBar.setDepth(4),this.updateBossHealthBar(),this.bossMusicTrack=this.sound.add("bossMusic",{loop:!0,volume:0}),this.bossTween=this.tweens.add({targets:this.boss,x:this.boss.x-400,duration:3e3,yoyo:!0,repeat:-1,paused:!0,onYoyo:function(){e.boss.setFlipX(!0)},onRepeat:function(){e.boss.setFlipX(!1),Math.random()<.5&&!e.boss.isDead&&e.boss.setVelocityY(-250)}}),this.hearts=this.add.group(),this.updateHealthDisplay(),this.scoreText=this.add.text(700,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",stroke:"#000",strokeThickness:4,align:"right"}),this.scoreText.setScrollFactor(0),this.scoreText.setDepth(1e3),this.scoreText.setOrigin(1,0),this.gameMusic=this.sound.add("gameMusic",{loop:!0,volume:0}),this.gameMusic.play(),this.tweens.add({targets:this.gameMusic,volume:.5,duration:2e3}),this.physics.add.collider(this.player,this.ground),this.physics.add.collider(this.boss,this.ground),this.physics.add.collider(this.possums,this.ground),this.physics.add.overlap(this.player,this.boss,this.handleBossCollision,null,this),this.physics.add.overlap(this.player,this.possums,this.handlePossumCollision,null,this),this.cameras.main.startFollow(this.player,!0,.08,.08),this.bats=this.physics.add.group(),this.batSpawnTimer=this.time.addEvent({delay:3e3,callback:function(){e.stageRevealed||e.isRevealSequence||!e.bats||e.spawnBat()},callbackScope:this,loop:!0}),this.physics.add.collider(this.bats,this.ground),this.physics.add.overlap(this.player,this.bats,this.handleBatCollision,(function(){return!e.stageRevealed&&!e.isRevealSequence&&e.bats&&e.bats.getChildren().length>0}),this)}},{key:"spawnPossum",value:function(){try{var e=this.possums.create(this.cameras.main.scrollX+900,450,"possum");e.setVelocityX(-150),e.play("possum-walk"),e.setScale(1.5),e.setDepth(3),e.setBounce(.2),e.setCollideWorldBounds(!0),e.checkWorldBounds=!0,e.outOfBoundsKill=!0,this.time.addEvent({delay:2e3,callback:function(){e.active&&!e.isDead&&e.setVelocityY(-300)},loop:!0})}catch(e){console.error("Error spawning possum:",e)}}},{key:"handlePossumCollision",value:function(e,t){e.body.velocity.y>0&&e.y<t.y&&!t.isDead?(this.killPossum(t),e.setVelocityY(-300)):this.isInvulnerable||t.isDead||(this.takeDamage(),this.makePlayerInvulnerable())}},{key:"killPossum",value:function(e){e.isDead=!0;var t=this.add.image(e.x,e.y,"burst");t.setScale(.5),this.score+=10,this.scoreText.setText("Score: "+this.score),this.tweens.add({targets:t,scale:2,alpha:0,duration:500,ease:"Power2",onComplete:function(){t.destroy()}}),e.setVelocity(0,0),this.tweens.add({targets:e,alpha:0,duration:200,ease:"Power2",onComplete:function(){e.destroy()}})}},{key:"makePlayerInvulnerable",value:function(){var e=this;this.isInvulnerable=!0,this.player.setTint(16711680),this.tweens.add({targets:this.player,alpha:.5,duration:100,yoyo:!0,repeat:4,ease:"Linear",onComplete:function(){e.player.setAlpha(1),e.player.clearTint(),e.isInvulnerable=!1}})}},{key:"takeDamage",value:function(){this.health>0&&(this.health--,this.updateHealthDisplay(),0===this.health&&(this.gameMusic&&this.gameMusic.isPlaying&&this.gameMusic.stop(),this.bossMusicTrack&&this.bossMusicTrack.isPlaying&&this.bossMusicTrack.stop(),this.scene.start("GameOverScene",{score:this.score})))}},{key:"updateHealthDisplay",value:function(){this.hearts.clear(!0,!0);for(var e=0;e<this.health;e++){var t=this.add.image(50+40*e,50,"heart");t.setScrollFactor(0),t.setDepth(1e3),t.setScale(.5),this.hearts.add(t)}}},{key:"update",value:function(){var e=this.player.body.touching.down;this.boss&&!this.boss.isDead&&this.updateBossHealthBar(),!this.stageRevealed&&this.player.x>4e3&&(this.stageRevealed=!0,this.revealStage()),this.isRevealSequence||(this.cursors.left.isDown?(this.player.setVelocityX(-300),this.player.setFlipX(!0),e&&this.player.play("walk",!0)):this.cursors.right.isDown&&(!this.stageRevealed||this.player.x<4750)?(this.player.setVelocityX(300),this.player.setFlipX(!1),e&&this.player.play("walk",!0)):(this.player.setVelocityX(0),e&&this.player.play("idle",!0)),this.spaceKey&&this.spaceKey.isDown&&e&&this.player.setVelocityY(-400)),!this.isRevealSequence&&this.player.y>this.game.config.height&&(this.takeDamage(),this.player.setPosition(this.cameras.main.scrollX+100,450))}},{key:"revealStage",value:function(){var e=this;this.isRevealSequence=!0,this.batSpawnTimer&&this.batSpawnTimer.destroy(),this.bats.clear(!0,!0);var t=this.player.x,s=this.player.y;this.player.setVelocityX(0),this.player.setVelocityY(0),this.cameras.main.stopFollow(),this.cameras.main.pan(4400,300,2e3,"Power2",!0,(function(i,a){1===a&&(e.player.x=t,e.player.y=s,e.physics.world.setBounds(4e3,0,800,600),e.player.setCollideWorldBounds(!0),e.boss.setCollideWorldBounds(!0),e.animalBand.setVisible(!0),e.bandTween.play(),e.boss.x=4700,e.boss.y=450,e.possumSpawnTimer&&e.possumSpawnTimer.destroy(),e.possums.getChildren().forEach((function(t){e.tweens.add({targets:t,alpha:0,duration:500,ease:"Power2",onComplete:function(){t.destroy()}})})),e.tweens.add({targets:e.gameMusic,volume:0,duration:2e3,ease:"Power2"}),e.bossMusicTrack.play(),e.tweens.add({targets:e.bossMusicTrack,volume:.5,duration:2e3,ease:"Power2"}),e.tweens.add({targets:[e.boss,e.bossHealthBar],alpha:1,duration:1500,ease:"Power2",onComplete:function(){e.bossTween.stop(),e.bossTween=e.tweens.add({targets:e.boss,x:4300,duration:3e3,yoyo:!0,repeat:-1,onYoyo:function(){e.boss.setFlipX(!0)},onRepeat:function(){e.boss.setFlipX(!1),Math.random()<.5&&!e.boss.isDead&&e.boss.setVelocityY(-250)}}),e.isRevealSequence=!1}}))}))}},{key:"handleBossCollision",value:function(e,t){if(this.stageRevealed&&!t.isDead&&!this.isRevealSequence){var s=e.y+e.height*e.scale/2,i=t.y-t.height*t.scale/2,a=t.height*t.scale*.4;if(e.body.velocity.y>0&&s<i+a&&!t.isHurt)this.hitBoss(),e.setVelocityY(-500);else if(!this.isInvulnerable&&!t.isHurt&&s>i+a){this.takeDamage(),this.makePlayerInvulnerable();var o=e.x<t.x?-1:1;e.setVelocityX(300*o),e.setVelocityY(-200)}}}},{key:"hitBoss",value:function(){var e=this;this.boss.isDead||this.boss.isHurt||(this.bossHealth--,this.updateBossHealthBar(),this.boss.isHurt=!0,this.boss.setTint(16711680),this.tweens.add({targets:this.boss,alpha:.5,duration:100,yoyo:!0,repeat:4,ease:"Linear",onComplete:function(){e.boss.isDead||(e.boss.setAlpha(1),e.boss.clearTint(),e.boss.isHurt=!1)}}),this.bossHealth<=0&&this.defeatBoss())}},{key:"updateBossHealthBar",value:function(){if(this.boss&&!this.boss.isDead){this.bossHealthBar.clear(),this.bossHealthBar.fillStyle(0,.7),this.bossHealthBar.fillRect(this.boss.x-50,this.boss.y-80,100,10);var e=this.bossHealth/7;this.bossHealthBar.fillStyle(16711680,1),this.bossHealthBar.fillRect(this.boss.x-50,this.boss.y-80,100*e,10)}}},{key:"defeatBoss",value:function(){var e=this;if(!this.boss.isDead){this.boss.isDead=!0,this.bossDefeated=!0,this.bossTween&&this.bossTween.stop(),this.boss.setVelocity(0,0),this.tweens.add({targets:this.bossMusicTrack,volume:0,duration:2e3,ease:"Power2",onComplete:function(){e.bossMusicTrack.stop()}}),this.score+=2e3,this.scoreText.setText("Score: "+this.score);var t=function(t){var s=e.add.image(e.boss.x+Phaser.Math.Between(-30,30),e.boss.y+Phaser.Math.Between(-30,30),"burst");s.setScale(.5),s.setAlpha(.7),e.tweens.add({targets:s,scale:2,alpha:0,duration:800,delay:t,ease:"Power2",onComplete:function(){return s.destroy()}})},s=[16776960,65280,255,16711935,16711680],i=0,a=0,o=this.time.addEvent({delay:100,callback:function(){if(e.boss&&!e.boss.destroyed&&(e.boss.setTint(s[i]),i=(i+1)%s.length,++a%2==0&&t(0),a>=10)){o.destroy();for(var r=0;r<5;r++)t(200*r);var n=e.add.image(e.cameras.main.centerX,e.cameras.main.centerY,"final");n.setScrollFactor(0),n.setDepth(1e3),n.setAlpha(0);var l=e.cameras.main.width/n.width,h=e.cameras.main.height/n.height,c=Math.min(l,h);n.setScale(c),e.tweens.add({targets:n,alpha:1,duration:2e3,ease:"Power2",onComplete:function(){e.time.delayedCall(1e3,(function(){e.scene.start("EndScene",{score:e.score})}))}}),e.tweens.add({targets:e.boss,scaleX:1.5,scaleY:0,alpha:0,duration:1e3,ease:"Power2",onComplete:function(){e.boss&&e.boss.destroy(),e.bossHealthBar&&e.bossHealthBar.destroy()}})}},loop:!0})}}},{key:"spawnBat",value:function(){if(!this.stageRevealed&&!this.isRevealSequence&&this.bats){var e=this.bats.create(this.cameras.main.scrollX+900,Phaser.Math.Between(50,150),"bat"),t=80/this.textures.get("bat").getSourceImage().height;e.setScale(t),e.setBounce(.2),e.setCollideWorldBounds(!0),e.setVelocityX(-200),e.setDepth(3),e.alpha=1,this.tweens.add({targets:e,y:500,duration:2e3,ease:"Sine.InOut",yoyo:!0,repeat:-1}),e.checkWorldBounds=!0,e.outOfBoundsKill=!0}}},{key:"handleBatCollision",value:function(e,t){if(!(t.isDead||this.isRevealSequence||this.stageRevealed)){var s=e.y+e.height*e.scale/2,i=t.y-t.height*t.scale/2;e.body.velocity.y>0&&s<i+30?(this.killBat(t),e.setVelocityY(-300)):this.isInvulnerable||(this.takeDamage(),this.makePlayerInvulnerable())}}},{key:"killBat",value:function(e){var t=this;e.isDead=!0;var s=this.add.image(e.x,e.y,"burst");s.setScale(.5),this.score+=15,this.scoreText.setText("Score: "+this.score);var i=this.physics.add.sprite(e.x,e.y,"heart");i.setScale(.4),i.setBounce(.4),i.setCollideWorldBounds(!0),i.setVelocity(Phaser.Math.Between(-100,100),-200),this.physics.add.collider(i,this.ground),this.physics.add.overlap(this.player,i,(function(){t.health<3&&(t.health++,t.updateHealthDisplay()),i.destroy()}),null,this),this.time.delayedCall(1e4,(function(){i.active&&i.destroy()})),this.tweens.add({targets:s,scale:2,alpha:0,duration:500,ease:"Power2",onComplete:function(){s.destroy()}}),e.setVelocity(0,0),this.tweens.add({targets:e,alpha:0,duration:200,ease:"Power2",onComplete:function(){e.destroy()}})}}])&&le(t.prototype,s),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,s}();const ye={type:Phaser.AUTO,parent:"game",width:800,height:600,physics:{default:"arcade",arcade:{gravity:{y:300},debug:!1}},scene:[n,_,ae,W,Z,pe],pixelArt:!0,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH}};new Phaser.Game(ye)})();